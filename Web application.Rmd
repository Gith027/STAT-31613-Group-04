---
title: "Web application"
author: "K.A.G.D.Marapana -PS/2021/027"
date: "2025-09-15"
output: html_document
---

install.packages("Shiny)
```{r}
library("shiny")
library("dplyr")
```


```{r}
final_model <- lm( price_usd ~ make_year + mileage_kmpl + engine_cc + fuel_type + owner_count, data = train_df)
```


```{r}
#Define UI for the Shiny app
ui <- fluidPage(
  titlePanel("Used Car Price Prediction"),
  sidebarLayout(
    sidebarPanel(
      numericInput("make_year","Make Year:",value=2015,min=1980,max=2025,step=1),
      numericInput("mileage_kmpl","Mileage (Kmpl):",value = 15,min=5,max=50,step=0.1),
      numericInput("engine_cc", "Engine Size (cc):", value = 1500, min = 500, max = 5000, step = 100),
      selectInput("fuel_type", "Fuel Type:", choices = levels(df$fuel_type)),
      numericInput("owner_count", "Number of Owners:", value = 1, min = 1, max = 10, step = 1),
      actionButton("predict", "Predict Price")
    ),
    mainPanel(
      h3("Prediction Result"),
      verbatimTextOutput("prediction"),
      h4("Model Performance Metrics (Test Data)"),
      verbatimTextOutput("metrics")
    )
  )
)
```


```{r}
# Define server logic
server <- function(input, output) {
  # Prediction logic
  observeEvent(input$predict, {
    # Create data frame for prediction
    new_data <- data.frame(
      make_year = input$make_year,
      mileage_kmpl = input$mileage_kmpl,
      engine_cc = input$engine_cc,
      fuel_type = factor(input$fuel_type, levels = levels(df$fuel_type)),
      owner_count = input$owner_count
    )
  # Make prediction
    predicted_price <- predict(final_model, newdata = new_data)
    
    # Display prediction
    output$prediction <- renderPrint({
      paste("Predicted Car Price: $", round(predicted_price, 2))
    })
    # Calculate and display test data metrics (from your code)
    predicted_test <- predict(final_model, newdata = test_df)
    results_test <- data.frame(Actual = test_df$price_usd, Predicted = predicted_test)
    mae_test <- mean(abs(results_test$Actual - results_test$Predicted))
    rmse_test <- sqrt(mean((results_test$Actual - results_test$Predicted)^2))
    SSE_test <- sum((results_test$Actual - results_test$Predicted)^2)
    SST_test <- sum((results_test$Actual - mean(results_test$Actual))^2)
    r2_test <- 1 - SSE_test/SST_test
    
    output$metrics <- renderPrint({
      cat("Test Data Performance:\n")
      cat("MAE: ", round(mae_test, 2), "\n")
      cat("RMSE: ", round(rmse_test, 2), "\n")
      cat("R-squared: ", round(r2_test, 4), "\n")
    })
  })
}
```


```{r}
# Run the Shiny app
shinyApp(ui = ui, server = server)
```


```{r}
```


```{r}
```


```{r}
```

